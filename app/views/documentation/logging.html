


<ul>
<li><a class="reference internal" href="#">Logging</a><ul>
<li><a class="reference internal" href="#adapters">Adapters</a></li>
<li><a class="reference internal" href="#creating-a-log">Creating a Log</a></li>
<li><a class="reference internal" href="#transactions">Transactions</a></li>
<li><a class="reference internal" href="#logging-to-multiple-handlers">Logging to Multiple Handlers</a></li>
<li><a class="reference internal" href="#message-formatting">Message Formatting</a><ul>
<li><a class="reference internal" href="#line-formatter">Line Formatter</a></li>
<li><a class="reference internal" href="#implementing-your-own-formatters">Implementing your own formatters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id1">Adapters</a><ul>
<li><a class="reference internal" href="#stream-logger">Stream Logger</a></li>
<li><a class="reference internal" href="#file-logger">File Logger</a></li>
<li><a class="reference internal" href="#syslog-logger">Syslog Logger</a></li>
<li><a class="reference internal" href="#implementing-your-own-adapters">Implementing your own adapters</a></li>
</ul>
</li>
</ul>
</li>
</ul>


  <div class="section" id="logging">
<h1>Logging<a class="headerlink" href="#logging" title="Ссылка на этот заголовок">¶</a></h1>
<p><tt class="xref doc docutils literal"><span class="pre">Phalcon\Logger</span></tt> is a component whose purpose is to provide logging services for applications. It offers logging to different backends using different adapters. It also offers transaction logging, configuration options, different formats and filters. You can use the <tt class="xref doc docutils literal"><span class="pre">Phalcon\Logger</span></tt> for every logging need your application has, from debugging processes to tracing application flow.</p>
<div class="section" id="adapters">
<h2>Adapters<a class="headerlink" href="#adapters" title="Ссылка на этот заголовок">¶</a></h2>
<p>This component makes use of adapters to store the logged messages. The use of adapters allows for a common interface for logging
while switching backends if necessary. The adapters supported are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="23%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Adapter</th>
<th class="head">Description</th>
<th class="head">API</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>File</td>
<td>Logs to a plain text file</td>
<td><tt class="xref doc docutils literal"><span class="pre">Phalcon\Logger\Adapter\File</span></tt></td>
</tr>
<tr class="row-odd"><td>Stream</td>
<td>Logs to a PHP Streams</td>
<td><tt class="xref doc docutils literal"><span class="pre">Phalcon\Logger\Adapter\Stream</span></tt></td>
</tr>
<tr class="row-even"><td>Syslog</td>
<td>Logs to the system logger</td>
<td><tt class="xref doc docutils literal"><span class="pre">Phalcon\Logger\Adapter\Syslog</span></tt></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="creating-a-log">
<h2>Creating a Log<a class="headerlink" href="#creating-a-log" title="Ссылка на этот заголовок">¶</a></h2>
<p>The example below shows how to create a log and add messages to it:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Logger\Adapter\File</span> <span class="k">as</span> <span class="nx">FileAdapter</span><span class="p">;</span>

<span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileAdapter</span><span class="p">(</span><span class="s2">&quot;app/logs/test.log&quot;</span><span class="p">);</span>
<span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">(</span><span class="s2">&quot;This is a message&quot;</span><span class="p">);</span>
<span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">(</span><span class="s2">&quot;This is an error&quot;</span><span class="p">,</span> <span class="nx">\Phalcon\Logger</span><span class="o">::</span><span class="na">ERROR</span><span class="p">);</span>
<span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s2">&quot;This is another error&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The log generated is below:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">[Tue, 17 Apr 12 22:09:02 -0500][DEBUG] This is a message</span>
<span class="x">[Tue, 17 Apr 12 22:09:02 -0500][ERROR] This is an error</span>
<span class="x">[Tue, 17 Apr 12 22:09:02 -0500][ERROR] This is another error</span>
</pre></div>
</div>
</div>
<div class="section" id="transactions">
<h2>Transactions<a class="headerlink" href="#transactions" title="Ссылка на этот заголовок">¶</a></h2>
<p>Logging data to an adapter i.e. File (file system) is always an expensive operation in terms of performance. To combat that, you
can take advantage of logging transactions. Transactions store log data temporarily in memory and later on write the data to the
relevant adapter (File in this case) in a single atomic operation.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Logger\Adapter\File</span> <span class="k">as</span> <span class="nx">FileAdapter</span><span class="p">;</span>

<span class="c1">// Create the logger</span>
<span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileAdapter</span><span class="p">(</span><span class="s2">&quot;app/logs/test.log&quot;</span><span class="p">);</span>

<span class="c1">// Start a transaction</span>
<span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">begin</span><span class="p">();</span>

<span class="c1">// Add messages</span>
<span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">alert</span><span class="p">(</span><span class="s2">&quot;This is an alert&quot;</span><span class="p">);</span>
<span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s2">&quot;This is another error&quot;</span><span class="p">);</span>

<span class="c1">// Commit messages to file</span>
<span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">commit</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="logging-to-multiple-handlers">
<h2>Logging to Multiple Handlers<a class="headerlink" href="#logging-to-multiple-handlers" title="Ссылка на этот заголовок">¶</a></h2>
<p><tt class="xref doc docutils literal"><span class="pre">Phalcon\Logger</span></tt> allows to send messages to multiple handlers with a just single call:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Logger</span><span class="p">,</span>
    <span class="nx">Phalcon\Logger\Multiple</span> <span class="k">as</span> <span class="nx">MultipleStream</span><span class="p">,</span>
    <span class="nx">Phalcon\Logger\Adapter\File</span> <span class="k">as</span> <span class="nx">FileAdapter</span><span class="p">,</span>
    <span class="nx">Phalcon\Logger\Adapter\Stream</span> <span class="k">as</span> <span class="nx">StreamAdapter</span><span class="p">;</span>

<span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MultipleStream</span><span class="p">();</span>

<span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">FileAdapter</span><span class="p">(</span><span class="s1">&#39;test.log&#39;</span><span class="p">));</span>
<span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamAdapter</span><span class="p">(</span><span class="s1">&#39;php://stdout&#39;</span><span class="p">));</span>

<span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">(</span><span class="s2">&quot;This is a message&quot;</span><span class="p">);</span>
<span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">(</span><span class="s2">&quot;This is an error&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">ERROR</span><span class="p">);</span>
<span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s2">&quot;This is another error&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The messages are sent to the handlers in the order they where registered.</p>
</div>
<div class="section" id="message-formatting">
<h2>Message Formatting<a class="headerlink" href="#message-formatting" title="Ссылка на этот заголовок">¶</a></h2>
<p>This component makes use of &#8216;formatters&#8217; to format messages before sent them to the backend. The formatters available are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="34%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Adapter</th>
<th class="head">Description</th>
<th class="head">API</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Line</td>
<td>Formats the messages using an one-line string</td>
<td><tt class="xref doc docutils literal"><span class="pre">Phalcon\Logger\Formatter\Line</span></tt></td>
</tr>
<tr class="row-odd"><td>Json</td>
<td>Prepares a message to be encoded with JSON</td>
<td><tt class="xref doc docutils literal"><span class="pre">Phalcon\Logger\Formatter\Json</span></tt></td>
</tr>
<tr class="row-even"><td>Syslog</td>
<td>Prepares a message to be sent to syslog</td>
<td><tt class="xref doc docutils literal"><span class="pre">Phalcon\Logger\Formatter\Syslog</span></tt></td>
</tr>
</tbody>
</table>
<div class="section" id="line-formatter">
<h3>Line Formatter<a class="headerlink" href="#line-formatter" title="Ссылка на этот заголовок">¶</a></h3>
<p>Formats the messages using a one-line string. The default logging format is:</p>
<p>[%date%][%type%] %message%</p>
<p>You can change the default format using setFormat(), this allows you to change the format of the logged
messages by defining your own. The log format variables allowed are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>%message%</td>
<td>The message itself expected to be logged</td>
</tr>
<tr class="row-odd"><td>%date%</td>
<td>Date the message was added</td>
</tr>
<tr class="row-even"><td>%type%</td>
<td>Uppercase string with message type</td>
</tr>
</tbody>
</table>
<p>The example below shows how to change the log format:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Logger\Formatter\Line</span> <span class="k">as</span> <span class="nx">LineFormatter</span><span class="p">;</span>

<span class="c1">//Changing the logger format</span>
<span class="nv">$formatter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">LineFormatter</span><span class="p">(</span><span class="s2">&quot;%date% - %message%&quot;</span><span class="p">);</span>
<span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">setFormatter</span><span class="p">(</span><span class="nv">$formatter</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="implementing-your-own-formatters">
<h3>Implementing your own formatters<a class="headerlink" href="#implementing-your-own-formatters" title="Ссылка на этот заголовок">¶</a></h3>
<p>The <tt class="xref doc docutils literal"><span class="pre">Phalcon\Logger\FormatterInterface</span></tt> interface must be implemented in order to
create your own logger formatter or extend the existing ones.</p>
</div>
</div>
<div class="section" id="id1">
<h2>Adapters<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h2>
<p>The following examples show the basic use of each adapter:</p>
<div class="section" id="stream-logger">
<h3>Stream Logger<a class="headerlink" href="#stream-logger" title="Ссылка на этот заголовок">¶</a></h3>
<p>The stream logger writes messages to a valid registered stream in PHP. A list of streams is available <a class="reference external" href="http://php.net/manual/en/wrappers.php">here</a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Logger\Adapter\Stream</span> <span class="k">as</span> <span class="nx">StreamAdapter</span><span class="p">;</span>

<span class="c1">// Opens a stream using zlib compression</span>
<span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StreamAdapter</span><span class="p">(</span><span class="s2">&quot;compress.zlib://week.log.gz&quot;</span><span class="p">);</span>

<span class="c1">// Writes the logs to stderr</span>
<span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StreamAdapter</span><span class="p">(</span><span class="s2">&quot;php://stderr&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="file-logger">
<h3>File Logger<a class="headerlink" href="#file-logger" title="Ссылка на этот заголовок">¶</a></h3>
<p>This logger uses plain files to log any kind of data. By default all logger files are open using
append mode which open the files for writing only; placing the file pointer at the end of the file.
If the file does not exist, attempt to create it. You can change this mode passing additional options to the constructor:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Logger\Adapter\File</span> <span class="k">as</span> <span class="nx">FileAdapter</span><span class="p">;</span>

<span class="c1">// Create the file logger in &#39;w&#39; mode</span>
<span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileAdapter</span><span class="p">(</span><span class="s2">&quot;app/logs/test.log&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;mode&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;w&#39;</span>
<span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="syslog-logger">
<h3>Syslog Logger<a class="headerlink" href="#syslog-logger" title="Ссылка на этот заголовок">¶</a></h3>
<p>This logger sends messages to the system logger. The syslog behavior may vary from one operating system to another.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Logger\Adapter\Syslog</span> <span class="k">as</span> <span class="nx">SyslogAdapter</span><span class="p">;</span>

<span class="c1">// Basic Usage</span>
<span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SyslogAdapter</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>

<span class="c1">// Setting ident/mode/facility</span>
<span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SyslogAdapter</span><span class="p">(</span><span class="s2">&quot;ident-name&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;option&#39;</span> <span class="o">=&gt;</span> <span class="nx">LOG_NDELAY</span><span class="p">,</span>
    <span class="s1">&#39;facility&#39;</span> <span class="o">=&gt;</span> <span class="nx">LOG_MAIL</span>
<span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="implementing-your-own-adapters">
<h3>Implementing your own adapters<a class="headerlink" href="#implementing-your-own-adapters" title="Ссылка на этот заголовок">¶</a></h3>
<p>The <tt class="xref doc docutils literal"><span class="pre">Phalcon\Logger\AdapterInterface</span></tt> interface must be implemented in order to
create your own logger adapters or extend the existing ones.</p>
</div>
</div>
</div>


